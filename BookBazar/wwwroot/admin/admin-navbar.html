<!-- Admin Top Navigation Bar -->
<nav class="top-nav">
    <div class="nav-left">
        <button id="sidebarToggle" class="nav-btn">
            <i class="fas fa-bars"></i>
        </button>
        <h2 class="dashboard-title" id="pageTitle">Admin Dashboard</h2>
    </div>
    <div class="nav-right">
        <div class="profile-dropdown">
            <button class="profile-btn">
                <i class="fas fa-user-circle"></i>
                <span id="adminName">Admin</span>
                <i class="fas fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="/admin/profile.html"><i class="fas fa-user"></i> Profile</a>
                <a href="/admin/settings.html"><i class="fas fa-cog"></i> Settings</a>
                <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
    </div>
</nav>

<!-- Admin Sidebar -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h3>BookBazar</h3>
    </div>
    <ul class="sidebar-menu">
        <li>
            <a href="/admin/dashboard.html">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
        </li>
        <li>
            <a href="/admin/book-management.html">
                <i class="fas fa-book"></i>
                <span>Book Management</span>
            </a>
        </li>
        <li>
            <a href="/admin/admin-users.html">
                <i class="fas fa-users"></i>
                <span>User Management</span>
            </a>
        </li>
        <li>
            <a href="/admin/inventory.html">
                <i class="fas fa-boxes"></i>
                <span>Inventory</span>
            </a>
        </li>
        <li>
            <a href="/admin/discounts.html">
                <i class="fas fa-tag"></i>
                <span>Discounts</span>
            </a>
        </li>
        <li>
            <a href="/admin/reports.html">
                <i class="fas fa-chart-line"></i>
                <span>Reports</span>
            </a>
        </li>
    </ul>
</aside>

<!-- Admin Navbar JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Check authentication
    const token = localStorage.getItem('token');
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    
    if (!token || !user || user.role !== 'Admin') {
        window.location.href = '/login.html';
        return;
    }
    
    // Set admin name
    if (user && user.username) {
        document.getElementById('adminName').textContent = user.username;
    }
    
    // Set page title based on current page
    const currentPage = window.location.pathname.split('/').pop().split('.')[0];
    const pageTitle = document.getElementById('pageTitle');
    if (pageTitle) {
        const formattedTitle = currentPage
            .split('-')
            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
            .join(' ');
        pageTitle.textContent = formattedTitle || 'Admin Dashboard';
    }
    
    // Toggle sidebar
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    
    if (sidebarToggle && sidebar) {
        sidebarToggle.addEventListener('click', function() {
            sidebar.classList.toggle('sidebar-collapsed');
            
            // For mobile view
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('sidebar-open');
            }
        });
    }
    
    // Logout functionality
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            logout();
        });
    }
    
    // Highlight current page in sidebar
    const currentPageFile = window.location.pathname.split('/').pop();
    const menuItems = document.querySelectorAll('.sidebar-menu li a');
    
    menuItems.forEach(item => {
        const href = item.getAttribute('href').split('/').pop();
        if (href === currentPageFile) {
            item.parentElement.classList.add('active');
        }
    });
    
    // Theme switcher functionality (if included in the app)
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    
    // Responsive behavior
    function handleResize() {
        if (window.innerWidth < 768) {
            sidebar.classList.add('sidebar-collapsed');
            sidebar.classList.remove('sidebar-open');
        } else if (window.innerWidth >= 992) {
            // Reset sidebar state for larger screens
            const savedSidebarState = localStorage.getItem('sidebarCollapsed');
            if (savedSidebarState === 'true') {
                sidebar.classList.add('sidebar-collapsed');
            } else {
                sidebar.classList.remove('sidebar-collapsed');
            }
        }
    }
    
    window.addEventListener('resize', handleResize);
    handleResize(); // Initialize
});

// Logout function
async function logout() {
    try {
        const token = localStorage.getItem('token');
        if (token) {
            await fetch('/auth/logout', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Content-Type': 'application/json'
                }
            });
        }
    } catch (err) {
        // Ignore errors
    } finally {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = '/login.html';
    }
}

</script>